%This work is licensed under the Creative Commons
%Attribution-ShareAlike 4.0 International License. To view a copy of
%this license, visit http://creativecommons.org/licenses/by-sa/4.0/ or
%send a letter to Creative Commons, PO Box 1866, Mountain View, CA
%94042, USA.

\input{header}


\begin{document}

\title[]{\textbf{B-Spline methods for the design of smooth spatial
  paths with obstacle avoidance}}
\date[15 July 2016]{15 July 2016}
%\subtitle{Master degree thesis}
\institute[Uni. Firenze]{
  \includegraphics[width=5cm]{img/logoUnifiName.eps}
}

\author[Martina Stefano]{
  \begin{center}
    \begin{tabular}{lr}
      Stefano \textsc{Martina}\\
      \href{mailto:stefano.martina@stud.unifi.it}{stefano.martina@stud.unifi.it}\\
    \end{tabular}
  \end{center}
}

% \titlegraphic{
%   \vspace{-0.5cm}
%   \tiny
%   \href{http://creativecommons.org/licenses/by-sa/4.0/}{\includegraphics[width=1cm]{img/logoCC.png}}
%   This work is licensed under a
%   \href{http://creativecommons.org/licenses/by-sa/4.0/}{Creative
%     Commons Attribution-ShareAlike 4.0 International License}.
% }

\newacro{VD}{Voronoi Diagram}

\acrodefplural{VD}[VDs]{Voronoi Diagrams}

\begin{frame}[plain]
  \titlepage
\end{frame}

\section{Prerequisites}

\begin{frame}
  \frametitle{Voronoi diagrams}
  \begin{description}
  \item[Input:] Set of points in plane (or space) called
    \alert{sites}
  \item[Output:]<2-> partition of the plane (or space) such that each
    point of a \alert{region} is closer to a certain site respect to
    others
  \end{description}
  \begin{columns}
    \begin{column}{0.5\textwidth}
      \begin{center}
        \includegraphics[width=\textwidth]{img/voroSites.eps}
      \end{center}
    \end{column}
    \begin{column}{0.5\textwidth}
      \begin{center}
        \includegraphics[width=\textwidth]<2->{img/voronoi.eps}
      \end{center}
    \end{column}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{B-spline curves}
  \begin{center}
    \includegraphics[width=0.9\textwidth, trim=110 30 50 50, clip]{img/bspline.eps}
  \end{center}
  \pause
  \begin{itemize}
  \item \alert{parametric} curves\pause
  \item follow the shape of a \alert{control poligon}\pause
  \item can interpolate the
    \alert{extremes} of control polygon
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{B-spline curves details}
  \begin{itemize}
  \item Degree \alert{$m$}\pause
  \item Extended \alert{partition} (of parametric
    space \alert{$[a,b]$})
    $$
    T=\{t_0,\dots,t_{m-1},\alert{t_{m}},\dots,\alert{t_{n+1}},t_{n+2},\dots,t_{n+m+1}\}
    $$
    {\tiny
      $$
      t_0\leq\dots\leq t_{m-1}\leq t_{m}\alert{(\equiv a)} <\dots<
      t_{n+1}\alert{(\equiv b)} \leq t_{n+2}\leq\dots\leq t_{n+m+1}
      $$
    }\pause
  \item \alert{$n+1$ basis} (of $S_{m,\tau}=P_{m,\tau}\cap C^{m-1}$)
    {\tiny
      \begin{align*}
        \alert{N_{i,1}(t)} &=
                     \begin{cases}
                       1,\quad \mbox{if}\quad t_i\leq t<t_{i+1}\\
                       0,\quad \mbox{otherwise}\qquad\qquad\qquad i=0,\dots,n+m
                     \end{cases}\\
        \alert{N_{i,r}(t)} &= \omega_{i,r-1}(t)\cdot \alert{N_{i,r-1}(t)}\ +\
                     (1-\omega_{i+1,r-1}(t))\cdot \alert{N_{i+1,r-1}(t)}\\
                   &\pushright i=0,\dots,n+m+1-3,\ r=2,\dots,m+1
      \end{align*}
    }
    {\tiny
      $$
      \omega_{i,r}(t) = \begin{cases}
        \frac{t-t_i}{t_{i+r}-t_i},&\mbox{if }t_i\neq t_{i+r}\\
        0, &\mbox{otherwise}
      \end{cases}
      $$
    }\pause
  \item B-spline $\ve{S}:[a,b]\subset\mR\rightarrow\mE^d$
    $$
    \alert{\mathbf{S}(t)}=\sum_{i=0}^n\alert{\mathbf{v_i}}\cdot N_{i,k}(t)
    $$
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Useful properties of B-spline curves}
  \begin{itemize}
  \item \alert{Interpolates} extremes if $t_0=\dots =t_{m}$ and $t_{n+1}=\dots
    =t_{n+m+1}$\pause
  \item \alert{Continuity} $C^{m-1}$ between polynomials\pause
  \item Contained in \alert{convex hulls} of 
    \alert{$m+1$} consecutive vertices
    \begin{center}
      \begin{tikzpicture}
        \coordinate (a) at (0,0);
        \coordinate (b) at (0.5,1);
        \coordinate (c) at (2,1.5);
        \coordinate (d) at (4,1.5);
        \coordinate (e) at (5.5,1);
        \coordinate (f) at (6,0);
        
        \path[convexHull] (a) -- (b) -- (c) -- (a);
        \path[convexHull] (b) -- (c) -- (d) -- (b);
        \path[convexHull] (c) -- (d) -- (e) -- (c);
        \path[convexHull] (d) -- (e) -- (f) -- (d);
        
        \draw[convexHullBord] (a) -- (c);
        \draw[convexHullBord] (b) -- (d);
        \draw[convexHullBord] (c) -- (e);
        \draw[convexHullBord] (d) -- (f);
        
        \draw[controlPoly] (a) -- (b) -- (c) -- (d) -- (e) -- (f);
        \foreach \p in {a,b,c,d,e,f}
        \filldraw[controlVert] (\p) circle (2pt);
      \end{tikzpicture}
    \end{center}\pause
  \item Touches segment between \alert{$m$ aligned}
    vertices\pause
  \item Lays in segment between \alert{$m+1$ aligned} vertices
  \end{itemize}
\end{frame}

\section{Background}

\begin{frame}
  \frametitle{Background}
  \begin{block}{Main problem}
    \alert{Path planning} from a \alert{start} point to an \alert{end}
    point in 3D space with obstacles using \alert{Voronoi} diagrams.
  \end{block}\pause
  \begin{enumerate}
  \item Distribute \alert{points} in obstacles surfaces
    \begin{itemize}
    \item and bounding box\pause
    \end{itemize}
  \item \alert{Voronoi} diagram using those points\pause
  \item Transform Voronoi diagram in \alert{graph}
    \begin{itemize}
    \item cells \alert{vertices} $\rightarrow$ \alert{nodes}
    \item cells \alert{edges} $\rightarrow$ \alert{arcs} (infinite edges
      ignored)\pause
    \end{itemize}
  \item \alert{Prune} arcs that cross obstacles\pause
  \item Attach \alert{start} and \alert{end}\pause
  \item Shortest path from start to end
    \begin{itemize}
    \item \alert{Dijkstra}'s algorithm
    \end{itemize}
  \end{enumerate}
\end{frame}

\begin{frame}
  \frametitle{Example}
  \begin{center}
    \includegraphics[width=0.9\textwidth]<1>{img/scrEmpty.png}
    \includegraphics[width=0.9\textwidth]<2>{img/scrSites-a.png}
    \includegraphics[width=0.9\textwidth]<3>{img/scrSites-b.png}
    \includegraphics[width=0.9\textwidth]<4>{img/scrGraph-a.png}
    \includegraphics[width=0.9\textwidth]<5>{img/scrGraph-b.png}
  \end{center}
\end{frame}

\section{Implementation}

\begin{frame}
  \frametitle{Improvement}
  \begin{block}{Idea}
    \alert{Smoother} curve instead of polygonal chain
  \end{block}
  \pause
  \begin{itemize}
  \item Use a \alert{B-Spline} that \pause
    \begin{itemize}
    \item \alert{interpolate} the start and end\pause
    \item Shortest path as \alert{control polygon}
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Problem}  
  \begin{itemize}
  \item \alert{Control polygon} obstacle-free by
    construction\pause
    \begin{itemize}
    \item (pruned of arcs that cross obstacles)\pause
    \end{itemize}
  \item \alert{Curve} not obstacle-free guaranteed\pause
  \end{itemize}
  \begin{center}
    \begin{tikzpicture}
      \path[obstacle] (1,0) -- (2,1) -- (3,0) -- (1,0);
      \draw[controlPoly] (0,0) -- (2,2) -- (4,0);
      \draw[spline] (0,0) to [bend left=40] (4,0);

      \filldraw[controlVert] (0,0) circle (2pt);
      \filldraw[controlVert] (2,2) circle (2pt);
      \filldraw[controlVert] (4,0) circle (2pt);
    \end{tikzpicture}
  \end{center}
\end{frame}

\begin{frame}
  \frametitle{Solution}
  \begin{itemize}
  \item A \alert{B-Spline} of degree \alert{$m$} is contained
    inside the union of \alert{convex hulls} of
    \alert{$m+1$} consecutive vertices\pause
  \end{itemize}
  \begin{center}
    \begin{tikzpicture}
      \coordinate (a) at (0,0);
      \coordinate (b) at (0.5,1);
      \coordinate (c) at (2,1.5);
      \coordinate (d) at (4,1.5);
      \coordinate (e) at (5.5,1);
      \coordinate (f) at (6,0);

      \path[convexHull] (a) -- (b) -- (c) -- (a);
      \path[convexHull] (b) -- (c) -- (d) -- (b);
      \path[convexHull] (c) -- (d) -- (e) -- (c);
      \path[convexHull] (d) -- (e) -- (f) -- (d);

      \draw[convexHullBord] (a) -- (c);
      \draw[convexHullBord] (b) -- (d);
      \draw[convexHullBord] (c) -- (e);
      \draw[convexHullBord] (d) -- (f);

      \draw[controlPoly] (a) -- (b) -- (c) -- (d) -- (e) -- (f);
      \foreach \p in {a,b,c,d,e,f}
      \filldraw[controlVert] (\p) circle (2pt);
    \end{tikzpicture}
  \end{center}
  \pause
  \begin{block}{Idea}
    \begin{itemize}
    \item Use a \alert{quadratic} B-Spline to smooth path\pause
    \item \alert{Keep} triangles in control polygon \alert{obstacle-free}
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{First implementation}
  \begin{block}{Graph transformation (\alert{$G\rightarrow G_t$})}
    \begin{itemize}
    \item Triples \alert{$(a,b,c)$} of neighboring nodes in $G$ become
      nodes in $G_t$\pause
    \item Arcs in $G_t$ between triples in the form
      \alert{$(a,b,c)\rightarrow(b,c,d)$}\pause
      \begin{itemize}
      \item weighted with the distance of the edge
        \alert{$a\leftrightarrow b$} in $G$\pause
      \end{itemize}
    \end{itemize}
  \end{block}
  \begin{itemize}
  \item \alert{Prune} all the triples that intersect an obstacle\pause
  \item \alert{Shortest} path in the remaining triples\pause
  \end{itemize}
  \begin{center}
    \begin{tikzpicture}
      \coordinate (D) at (-1,1);
      \coordinate (A) at (0,0);
      \coordinate (B) at (2,2);
      \coordinate (C) at (4,0);
      \coordinate (E) at (3,2);
      \coordinate (F) at (5,1);
      \path[obstacle] (1,-0.5) -- (2,1) -- (3,-0.5) -- (1,-0.5);
      \draw[controlPoly] (D) -- (A) -- (B) -- (C) -- (F);
      \draw[controlPoly] (B) -- (E) -- (C);

      \filldraw[controlVert] (D) circle (2pt);
      \filldraw[controlVert] (A) circle (2pt);
      \filldraw[controlVert] (B) circle (2pt);
      \filldraw[controlVert] (C) circle (2pt);
      \filldraw[controlVert] (E) circle (2pt);
      \filldraw[controlVert] (F) circle (2pt);

      \node[above=0.5em] at (D) {$\ve{d}$};
      \node[below=0.5em] at (A) {$\ve{a}$};
      \node[above=0.5em] at (B) {$\ve{b}$};
      \node[below=0.5em] at (C) {$\ve{c}$};
      \node[above=0.5em] at (E) {$\ve{e}$};
      \node[above=0.5em] at (F) {$\ve{f}$};
    \end{tikzpicture}
  \end{center}
\end{frame}

\begin{frame}
  \frametitle{Complexity}
  \begin{center}
    \begin{tabular}{|l|c|}
      \hline
      Description&Cost\\
      \hline
      \hline
      Creation of $G$&\eqCostGraph\\
      Pruning of $G$&\eqCostPruning\\
      Creation of $G_t$&\eqCostVt\\
      Pruning of $G_t$&\eqCostColl\\
      Routing in $G_t$& \eqCostDijkstraTriples\\
      \hline
      Total&\eqCostTotalOne\\
      Total ($k$ constant)&\eqCostTotalOneK\\
      \hline
    \end{tabular}
  \end{center}
  \begin{itemize}
  \item Scene construction
    \begin{itemize}
    \item \alert{$\bigO(|O|^2)$}\pause
    \end{itemize}
  \item Routing
    \begin{itemize}
    \item \alert{$\bigO(|O|\log|O|)$}\pause
    \item (same of Dijkstra with constant degree)
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Second implementation}
  \begin{block}{Reason}
    \begin{itemize}
    \item \alert{First} implementation interesting\pause
    \item[\xmark] but \alert{rejects} many paths
    \end{itemize}
  \end{block}\pause
  \begin{itemize}
  \item \alert{Add} aligned control vertices when obstacle intersect triple
    \begin{center}
      \begin{tikzpicture}
        \path[obstacle] (1,0) -- (2,1) -- (3,0) -- (1,0);
        \draw[controlPoly] (0,0) -- (2,2) -- (4,0);

        \filldraw[controlVert] (0,0) circle (2pt);
        \filldraw[controlVert] (2,2) circle (2pt);
        \filldraw[controlVert] (4,0) circle (2pt);\pause

        \only<4->{
          \draw[controlPolyTract] (1,1) -- (3,1);
          \filldraw[controlVertHigh] (1,1) circle (2pt);
          \filldraw[controlVertHigh] (3,1) circle (2pt);
        }
      \end{tikzpicture}
    \end{center}\pause
  \item new vertices \alert{easy} calculated after collision check
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Complexity}
  \begin{center}
    \begin{tabular}{|l|c|r|}
      \hline
      Description&Cost\\
      \hline
      \hline
      Creation of $G$&\eqCostGraph\\
      Pruning of $G$&\eqCostPruning\\
      Routing in $G$&\eqCostDijkstraG\\
      Clean path&\eqCostCleanPath\\
      \hline
      Total&\eqCostTotalTwo\\
      Total ($k$ costant)&\eqCostTotalTwoK\\
      \hline
    \end{tabular}
  \end{center}
  \begin{itemize}
  \item Scene construction
    \begin{itemize}
    \item \alert{$\bigO(|O|^2)$}\pause
    \end{itemize}
  \item Routing
    \begin{itemize}
    \item \alert{$\bigO(|O|\log|O|+|P|\ |O|)$}
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Increase degree}
  \begin{block}{Continuity}
    \begin{itemize}
    \item Using \alert{quadratic} B-Splines means \alert{$C^1$} continuity\pause
    \item[\xmark] Not nice
    \end{itemize}
  \end{block}\pause
  \begin{itemize}
  \item[\xmark] If \alert{increase} the B-Spline degree \alert{$\rightarrow$} convex hull not
    \alert{planar} anymore\pause
    \begin{itemize}
    \item convex hull formed of union of \alert{tetrahedra}\pause
    \end{itemize}
  \end{itemize}
  \begin{block}{Solution}
    \begin{itemize}
    \item \alert{Add} aligned vertices in control polygon\pause
      \begin{itemize}
      \item then \alert{increase} the degree
      \end{itemize}
    \end{itemize}
  \end{block}
\end{frame}

\begin{frame}
  \frametitle{Example: quadratic to quartic (k=3 $\rightarrow$ k=5)}
  \begin{itemize}
  \item Add \alert{2} vertices per edge
  \end{itemize}\pause
  \begin{center}
    \begin{tikzpicture}[scale=1.5]
      \coordinate (a1) at (0,2);
      \coordinate (a2) at (2,0.4);
      \coordinate (a3) at (4,1.6);
      \coordinate (a4) at (6,0);

      \coordinate (b1) at ($ (a1)!0.33!(a2) $);
      \coordinate (b2) at ($ (a2)!0.33!(a1) $);
      \coordinate (b3) at ($ (a2)!0.33!(a3) $);
      \coordinate (b4) at ($ (a3)!0.33!(a2) $);
      \coordinate (b5) at ($ (a3)!0.33!(a4) $);
      \coordinate (b6) at ($ (a4)!0.33!(a3) $);
      
      \only<-3>{
        \path[convexHull] (a1) -- (a2) -- (a3) -- (a1);
        \path[convexHull] (a2) -- (a3) -- (a4) -- (a2);
      
        \draw[convexHullBord] (a1) -- (a3);
        \draw[convexHullBord] (a2) -- (a4);
      }
      \only<4->{
        \path[convexHull] (a1) -- (b1) -- (b2) -- (a2) -- (b3) -- (a1);
        \path[convexHull] (b1) -- (b2) -- (a2) -- (b3) -- (b4) -- (b1);
        \path[convexHull] (b2) -- (a2) -- (b3) -- (b4) -- (a3) -- (b2);
        \path[convexHull] (a2) -- (b3) -- (b4) -- (a3) -- (b5) -- (a2);
        \path[convexHull] (b3) -- (b4) -- (a3) -- (b5) -- (b6) -- (b3);
        \path[convexHull] (b4) -- (a3) -- (b5) -- (b6) -- (a4) -- (b4);
      
        \draw[convexHullBord] (a1) -- (b3);
        \draw[convexHullBord] (b1) -- (b4);
        \draw[convexHullBord] (b2) -- (a3);
        \draw[convexHullBord] (a2) -- (b5);
        \draw[convexHullBord] (b3) -- (b6);
        \draw[convexHullBord] (b4) -- (a4);
      }

      \draw[controlPoly] (a1) -- (a2) -- (a3) -- (a4);
      \foreach \p in {a1,a2,a3,a4}
      \filldraw[controlVert] (\p) circle (2pt);

      \only<3->{
        \foreach \p in {b1,b2,b3,b4,b5,b6}
        \filldraw[controlVertHigh] (\p) circle (2pt);
      }
    \end{tikzpicture}
  \end{center}
\end{frame}

\begin{frame}
  \frametitle{Postprocessing}
  \begin{block}{Purpose}
    \begin{itemize}
    \item \alert{Simplify} the control polygon\pause
    \item \alert{Remove} useless turns
    \end{itemize}
  \end{block}\pause
  \begin{itemize}
  \item For each triple \alert{$(\ve{a},\ve{b},\ve{c})$} of
    consecutive points in path\pause
  \item If no obstacles intersect the triangle\uncover<5->{ 
      \alert{$\rightarrow$} the triple is simplified to a single edge
      \alert{$(\ve{a},\ve{c})$}}
  \uncover<6->{\item[\hmark] After simplification, \alert{new} neighbouring triples need to
    be obstacle-free}
  \end{itemize}
  \begin{center}
    \begin{tikzpicture}
      \coordinate (a) at (0,0);
      \coordinate (b) at (2,2);
      \coordinate (c) at (4,0);

      \only<-4>{
        \draw[controlPoly] (a) -- (b) -- (c);
      
        \filldraw[controlVert] (a) circle (2pt);
        \filldraw[controlVert] (b) circle (2pt);
        \filldraw[controlVert] (c) circle (2pt);
      }
      \only<5->{
        \draw[controlPoly] (a) -- (c);
      
        \filldraw[controlVert] (a) circle (2pt);
        \filldraw[controlVertHigh] (b) circle (2pt);
        \filldraw[controlVert] (c) circle (2pt);
      }

      \node[left=0.5em] at (a) {$\ve{a}$};
      \node[left=0.5em] at (b) {$\ve{b}$};
      \node[right=0.5em] at (c) {$\ve{c}$};
    \end{tikzpicture}
  \end{center}
 \end{frame}

\begin{frame}
  \frametitle{Optimization method}
  
\end{frame}

\begin{frame}
  \frametitle{Used technologies}
  \begin{center}
    \visible<1->{\includegraphics[width=4cm]{img/python3.png}}\\[1cm]
    \visible<2->{\includegraphics[width=4cm]{img/scipy.png}}\\[1cm]
    \visible<3->{\includegraphics[width=4cm]{img/vtk.png}}
  \end{center}
\end{frame}

\begin{frame}
  \frametitle{Future improvements}
  \begin{itemize}
  \item Change underlying \alert{structure}\pause
    \begin{itemize}
    \item visibility graph\pause
    \item rapidly exploring random tree (RRT)\pause
    \item other \dots\pause
    \end{itemize}
  \item Improve \alert{postprocessing}\pause
    \begin{itemize}
    \item make a \alert{symmetric} algorithm (path from $a$ to $b$ $=$ path
      from $b$ to $a$)\pause
    \end{itemize}
  \item Make \alert{optimization} process\pause
    \begin{itemize}
    \item try to find the best path that satisfy some constraints\pause
      \begin{itemize}
      \item max \alert{curvature}\pause
      \item max \alert{torsion}\pause
      \item others \dots
      \end{itemize}
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \begin{center}
	\textbf{\calligra\Huge The End.}\\
  \includegraphics[width=5cm]{img/ornament.eps}\\[1cm]
	\pause
	{\huge\calligra Questions?\pause{} Thank you!}
  \end{center}
\end{frame}
\end{document}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: t
%%% End:
